{"version":3,"file":"gatsby-browser.js","sources":["../src/gatsby-browser.ts"],"sourcesContent":["import md5 from 'md5'\nimport omit from 'lodash.omit'\n\nimport { BROWSER_STORE_KEY } from './constants'\n\nimport { GatsbyBrowser } from 'gatsby'\nimport { BrowserPluginOptions } from './types'\n\ndeclare global {\n  interface Window {\n    [BROWSER_STORE_KEY]: BrowserPluginOptionsStore\n    // Used for the legacy Prismic Toolbar script.\n    prismic?: {\n      endpoint?: string\n    }\n  }\n}\n\nexport interface BrowserPluginOptionsStore {\n  [key: string]: {\n    pluginOptions: BrowserPluginOptions\n    schemasDigest: string\n  }\n}\n\nexport const onClientEntry: GatsbyBrowser['onClientEntry'] = (\n  _gatsbyContext,\n  pluginOptions: BrowserPluginOptions,\n) => {\n  if (pluginOptions.prismicToolbar === 'legacy')\n    // The legacy Prismic Toolbar script requires setting the endpoint globally\n    // to window.\n    window.prismic = {\n      endpoint: `https://${pluginOptions.repositoryName}.cdn.prismic.io/api/v2`,\n    }\n\n  window[BROWSER_STORE_KEY] = Object.assign({}, window[BROWSER_STORE_KEY], {\n    [pluginOptions.repositoryName]: {\n      pluginOptions: omit(pluginOptions, ['schemas', 'plugins']),\n      schemasDigest: md5(JSON.stringify(pluginOptions.schemas)),\n    },\n  })\n}\n"],"names":["_gatsbyContext","pluginOptions","prismicToolbar","window","prismic","endpoint","repositoryName","Object","assign","[object Object]","omit","schemasDigest","md5","JSON","stringify","schemas"],"mappings":"gJAyB6D,CAC3DA,EACAC,KAEqC,WAAjCA,EAAcC,iBAGhBC,OAAOC,QAAU,CACfC,oBAAqBJ,EAAcK,0CAGvCH,OAAM,0BAAsBI,OAAOC,OAAO,GAAIL,OAAM,0BAAqB,CACvEM,CAACR,EAAcK,gBAAiB,CAC9BL,cAAeS,EAAKT,EAAe,CAAC,UAAW,YAC/CU,cAAeC,EAAIC,KAAKC,UAAUb,EAAcc"}