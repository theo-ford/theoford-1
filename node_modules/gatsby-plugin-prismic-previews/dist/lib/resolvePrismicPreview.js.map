{"version":3,"file":"resolvePrismicPreview.js","sources":["../../../src/lib/resolvePrismicPreview.ts"],"sourcesContent":["import { navigate } from \"gatsby\";\n\nimport { fmtLog } from \"./fmtLog\";\nimport { getClient } from \"./getClient\";\nimport { getPluginOptions } from \"./getPluginOptions\";\nimport { getRepositoryConfig } from \"./getRepositoryConfig\";\n\nconst resolvePrismicPreview = async (\n\trepositoryName: string,\n\tabortController: AbortController,\n): Promise<void> => {\n\tconst pluginOptions = getPluginOptions(repositoryName);\n\tif (!pluginOptions) {\n\t\tconsole.error(\n\t\t\tfmtLog(\n\t\t\t\trepositoryName,\n\t\t\t\t'Plugin options could not be found. Did you add \"gatsby-plugin-prismic-previews\" for this repository to your app\\'s \"gatsby-config.js\" file?',\n\t\t\t),\n\t\t);\n\n\t\treturn;\n\t}\n\n\tconst repositoryConfig = getRepositoryConfig(repositoryName);\n\tif (!repositoryConfig) {\n\t\tconsole.error(\n\t\t\tfmtLog(\n\t\t\t\trepositoryName,\n\t\t\t\t'Repository configuration could not be found. Did you add <PrismicPreviewProvider> to your \"gatsby-browser.js\" and \"gatsby-ssr.js\"? It must contain a repository configuration object for this repository.',\n\t\t\t),\n\t\t);\n\n\t\treturn;\n\t}\n\n\tconst client = getClient(pluginOptions);\n\n\ttry {\n\t\tconst path = await client.resolvePreviewURL({\n\t\t\tlinkResolver: repositoryConfig.linkResolver,\n\t\t\tdefaultURL: \"/\",\n\t\t\tsignal: abortController.signal,\n\t\t});\n\n\t\tif (!abortController.signal.aborted) {\n\t\t\tnavigate(path);\n\t\t}\n\t} catch (error) {\n\t\tif (!(error instanceof Error && error.name === \"AbortError\")) {\n\t\t\tthrow error;\n\t\t}\n\t}\n};\n\nexport default resolvePrismicPreview;\n"],"names":[],"mappings":";;;;;AAOM,MAAA,wBAAwB,OAC7B,gBACA,oBACkB;AACZ,QAAA,gBAAgB,iBAAiB,cAAc;AACrD,MAAI,CAAC,eAAe;AACnB,YAAQ,MACP,OACC,gBACA,4IAA6I,CAC7I;AAGF;AAAA,EACA;AAEK,QAAA,mBAAmB,oBAAoB,cAAc;AAC3D,MAAI,CAAC,kBAAkB;AACtB,YAAQ,MACP,OACC,gBACA,2MAA2M,CAC3M;AAGF;AAAA,EACA;AAEK,QAAA,SAAS,UAAU,aAAa;AAElC,MAAA;AACG,UAAA,OAAO,MAAM,OAAO,kBAAkB;AAAA,MAC3C,cAAc,iBAAiB;AAAA,MAC/B,YAAY;AAAA,MACZ,QAAQ,gBAAgB;AAAA,IAAA,CACxB;AAEG,QAAA,CAAC,gBAAgB,OAAO,SAAS;AACpC,eAAS,IAAI;AAAA,IACb;AAAA,WACO;AACR,QAAI,EAAE,iBAAiB,SAAS,MAAM,SAAS,eAAe;AACvD,YAAA;AAAA,IACN;AAAA,EACD;AACF;"}