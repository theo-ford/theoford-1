function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}var r=e(require("fs")),n=e(require("path")),t=require("gatsby/graphql"),i=require("fp-ts/lib/Task"),a=require("fp-ts/lib/TaskEither"),o=require("fp-ts/lib/pipeable"),u=require("fp-ts/lib/Array"),c=require("fp-ts/lib/Option"),s=require("fp-ts/lib/Record"),l=require("fp-ts/lib/Eq"),p=require("fp-ts/lib/Ord"),f=e(require("node-fetch")),h=e(require("md5")),d=require("fp-ts/lib/Semigroup"),m=require("fp-ts/lib/function"),g=e(require("imgix-url-params/dist/parameters.json")),y=require("camel-case"),v=require("fp-ts/lib/Apply");function b(){return(b=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var n=arguments[r];for(var t in n)Object.prototype.hasOwnProperty.call(n,t)&&(e[t]=n[t])}return e}).apply(this,arguments)}function x(e,r){(null==r||r>e.length)&&(r=e.length);for(var n=0,t=new Array(r);n<r;n++)t[n]=e[n];return t}function P(e,r){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,r){if(e){if("string"==typeof e)return x(e,void 0);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,void 0):void 0}}(e))||r&&e&&"number"==typeof e.length){n&&(e=n);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function S(e,r,n){e||n.panic("Invariant failed: "+r)}var L,w=function(){},G=function(e,r){var n=new URL("https://"+r);return n.pathname=encodeURIComponent(e),n.toString()},Q=function(e,r){return void 0===e&&(e=""),""+e+r},I=function(e,r,n){return o.pipe(function(e,r){return function(){return r.get(e).then(function(e){return c.fromNullable(e)})}}(e,r),a.rightTask,a.chain(c.fold(m.flow(n,a.chain(m.flow(function(e,r){return function(n){return function(){return r.set(e,n).then(function(){return n})}}}(e,r),function(e){return a.rightTask(e)}))),a.right)))},U=function(e){return a.tryCatch(function(){return f(e)},function(e){return new Error(String(e))})},N=(m.flow(U,a.chain(function(e){return a.rightTask(function(){return e.buffer()})}),a.chain(function(e){return a.right(e.toString("base64"))})),d.getObjectSemigroup()),T=function(e){return function(r){return r.join(e)}},k=function(e,r){return function(n){return a.tryCatch(function(){return Promise.resolve(e(n)).then(function(e){return null==e?Promise.reject("Resolved data is null or undefined"):r?r(e)?e:Promise.reject("Resolved data is invalid."):e})},function(e){return new Error(String(e))})}},W=[1,1.5,2],j=[.25,.5,1.5,2],q={w:100,blur:15,q:20},A=function(e,r){return function(n){return o.pipe(n,s.filterMap(function(e){return c.some(void 0===e?void 0:String(e))}),function(e){return function(r){var n,t,i,a=new URL(e),c=o.pipe(r,s.reduceWithIndex([],function(e,r,n){return void 0===n?u.cons(e,r):r})),l=o.pipe(r,s.filter(function(e){return void 0!==e})),p=(n=a.searchParams,t=new URLSearchParams(l),i=new URLSearchParams(n.toString()),t.forEach(function(e,r){null==e?i.delete(r):i.set(r,e)}),i);return p.forEach(function(e,r){c.includes(r)&&p.delete(r)}),a.search=p.toString(),a.toString()}}(e),function(e){return function(r){return o.pipe(e,c.fold(function(){return r},function(e){return o.pipe(r,function(e){var r=new URL(e);return r.searchParams.delete("s"),r.toString()},(n=function(e){return function(r){return o.pipe(new URL(r),function(r){return e+r.pathname+r.search},h)}}(e)(r),function(e){var r=new URL(e);return r.searchParams.append("s",String(n)),r.toString()}));var n}))}}(c.fromNullable(r)))}},R=function(e,r){return function(n){return o.pipe(N.concat(q,n),A(e,r))}},O=new t.GraphQLInputObjectType({name:"ImgixUrlParamsInput",fields:Object.keys(g.parameters).reduce(function(e,r){var n=g.parameters[r],i=y.camelCase(r),a=Array.from(new Set(n.expects.map(function(e){return e.type}))),o=a.every(function(e){return"integer"===e||"unit_scalar"===e})?t.GraphQLInt:a.every(function(e){return"integer"===e||"unit_scalar"===e||"number"===e})?t.GraphQLFloat:a.every(function(e){return"boolean"===e})?t.GraphQLBoolean:t.GraphQLString;if(e[i]={type:o,description:n.short_description+("."===n.short_description.slice(-1)?"":".")},"default"in n&&(e[i].description=e[i].description+" Default: `"+n.default+"`."),"url"in n&&(e[i].description=e[i].description+" [See docs]("+n.url+")."),"aliases"in n)for(var u,c=P(n.aliases);!(u=c()).done;)e[y.camelCase(u.value)]=b({},e[i],{description:"Alias for `"+i+"`."});return e},{})}),E=v.sequenceT(a.taskEither),C=function(e,r,n,t,i){return function(u){return o.pipe(E(k(r)(e),k(n)(e)),a.fold(function(){return o.pipe(u,function(e,r){return function(n){return I("gatsby-plugin-imgix-metadata-"+n,e,function(){return o.pipe({fm:"json"},A(n,r),function(e){return function(e){return o.pipe(e,U,a.chain(function(e){return a.rightTask(function(){return e.json()})}))}(e)})})}}(t,i),a.map(function(e){return[e.PixelWidth,e.PixelHeight]}))},a.right))}},F=function(e){return n=(r=e).resolveUrl,u=r.secureUrlToken,s=void 0===(c=r.defaultImgixParams)?{}:c,{type:t.GraphQLString,args:{imgixParams:{type:O,defaultValue:{}}},resolve:function(e,r){return o.pipe(e,k(n),a.map(function(e){var n;return o.pipe(N.concat(s,null!==(n=r.imgixParams)&&void 0!==n?n:{}),A(e,u))}),a.fold(function(){return i.of(void 0)},i.of))()}};var r,n,u,c,s},H=function(e){var r=e.resolveUrl,n=void 0===r?function(e){return e.base64}:r,u=e.cache;return{type:new t.GraphQLNonNull(t.GraphQLString),resolve:function(e){return o.pipe(e,k(n),a.chain(function(e){return function(r){return I("gatsby-plugin-imgix-base64-url-"+r,e,function(){return o.pipe(r,U,a.chain(function(e){return o.pipe(a.rightTask(function(){return e.buffer()}),a.chain(function(e){return a.right(e.toString("base64"))}),a.chain(function(r){return a.right(function(e,r){return"data:"+e+";base64,"+r}(String(e.headers.get("content-type")),r))}))}))})}}(u)),a.fold(function(){return i.of(void 0)},i.of))()}}},M=function(e){return n=(r=e).resolveUrl,s=void 0===(c=r.resolveWidth)?w:c,p=void 0===(l=r.resolveHeight)?w:l,f=r.secureUrlToken,h=r.cache,d=r.defaultImgixParams,m=r.defaultPlaceholderImgixParams,{type:r.type,args:{width:{type:t.GraphQLInt,defaultValue:400},height:{type:t.GraphQLInt},imgixParams:{type:O,defaultValue:{}},placeholderImgixParams:{type:O,defaultValue:{}}},resolve:function(e,r){return o.pipe(e,k(n,function(e){return"string"==typeof e}),a.chain(function(n){return o.pipe(n,C(e,s,p,h,f),a.map(function(e){return function(e){var r,n,t=e.url,i=e.secureUrlToken,a=e.args,c=void 0===a?{}:a,s=e.sourceWidth/e.sourceHeight;null!=c.width&&null!=c.height?(r=c.width,n=c.height):null!=c.width?(r=c.width,n=Math.round(r/s)):null!=c.height?(r=Math.round(c.height*s),n=c.height):(r=400,n=Math.round(r/s));var l=R(t,i)(b({},c.imgixParams,c.placeholderImgixParams)),p=A(t,i)(b({},c.imgixParams,{w:r,h:n})),f=function(e,r){return function(n){return o.pipe(W,u.map(function(t){return o.pipe(N.concat(n,{dpr:t}),A(e,r),function(e){return e+" "+t+"x"})}),T(", "))}}(t,i)(b({},c.imgixParams,{w:r,h:n}));return{base64:l,width:r,height:n,src:p,srcWebp:p,srcSet:f,srcSetWebp:f}}({url:n,sourceWidth:e[0],sourceHeight:e[1],secureUrlToken:f,args:b({},r,{imgixParams:b({},d,r.imgixParams),placeholderImgixParams:b({},m,r.placeholderImgixParams)})})}))}),a.getOrElseW(function(){return i.of(void 0)}))()}};var r,n,c,s,l,p,f,h,d,m},z=function(e){return n=(r=e).resolveUrl,s=void 0===(c=r.resolveWidth)?w:c,h=void 0===(f=r.resolveHeight)?w:f,d=r.secureUrlToken,m=r.cache,g=r.defaultImgixParams,y=r.defaultPlaceholderImgixParams,{type:r.type,args:{maxWidth:{type:t.GraphQLInt,defaultValue:800},maxHeight:{type:t.GraphQLInt},srcSetBreakpoints:{type:new t.GraphQLList(t.GraphQLInt)},imgixParams:{type:O,defaultValue:{}},placeholderImgixParams:{type:O,defaultValue:{}}},resolve:function(e,r){return o.pipe(e,k(n,function(e){return"string"==typeof e}),a.chain(function(n){return o.pipe(n,C(e,s,h,m,d),a.map(function(e){return function(e){var r,n,t=e.url,i=e.secureUrlToken,a=e.args,c=void 0===a?{}:a,s=e.sourceWidth/e.sourceHeight,f=null!==(r=c.maxWidth)&&void 0!==r?r:800,h=R(t,i)(b({},c.imgixParams,c.placeholderImgixParams)),d=A(t,i)(b({},c.imgixParams,{w:f,h:c.maxHeight})),m=function(e,r){return function(n){return function(t){var i=t.aspectRatio,a=t.maxWidth,c=t.srcSetBreakpoints,s=void 0===c?j.map(function(e){return a*e}):c;return o.pipe(u.cons(a,s),u.uniq(l.eqNumber),u.sort(p.ordNumber),u.map(function(t){return o.pipe(N.concat(n,{w:Math.round(t),h:Math.round(t/i)}),A(e,r),function(e){return e+" "+Math.round(t)+"w"})}),T(", "))}}}(t,i)(null!==(n=c.imgixParams)&&void 0!==n?n:{})({aspectRatio:s,maxWidth:f,srcSetBreakpoints:c.srcSetBreakpoints});return{base64:h,aspectRatio:s,src:d,srcWebp:d,srcSet:m,srcSetWebp:m,sizes:""}}({url:n,sourceWidth:e[0],sourceHeight:e[1],secureUrlToken:d,args:b({},r,{imgixParams:b({},g,r.imgixParams),placeholderImgixParams:b({},y,r.placeholderImgixParams)})})}))}),a.getOrElseW(function(){return i.of(void 0)}))()}};var r,n,c,s,f,h,d,m,g,y};!function(e){e.AmazonS3="s3",e.GoogleCloudStorange="gcs",e.MicrosoftAzure="azure",e.WebFolder="webFolder",e.WebProxy="webProxy"}(L||(L={})),exports.createSchemaCustomization=function(e,r){try{var n=e.cache,i=e.schema,a=e.reporter,o=e.actions.createTypes,u=r.secureUrlToken,c=r.sourceType,s=r.namespace,l=r.defaultImgixParams,p=r.defaultPlaceholderImgixParams,f=r.fields,h=void 0===f?[]:f;S(Array.isArray(h),"fields must be an array of field options",a),S(c!==L.WebProxy||Boolean(u),"a secure URL token must be provided if sourceType is webProxy",a);var d=(v={name:Q(s,"ImgixFixed"),cache:n},new t.GraphQLObjectType({name:v.name,fields:{base64:H({cache:v.cache}),src:{type:new t.GraphQLNonNull(t.GraphQLString)},srcSet:{type:new t.GraphQLNonNull(t.GraphQLString)},srcWebp:{type:new t.GraphQLNonNull(t.GraphQLString)},srcSetWebp:{type:new t.GraphQLNonNull(t.GraphQLString)},sizes:{type:new t.GraphQLNonNull(t.GraphQLString)},width:{type:new t.GraphQLNonNull(t.GraphQLInt)},height:{type:new t.GraphQLNonNull(t.GraphQLInt)}}})),m=function(e){return new t.GraphQLObjectType({name:e.name,fields:{base64:H({cache:e.cache}),src:{type:new t.GraphQLNonNull(t.GraphQLString)},srcSet:{type:new t.GraphQLNonNull(t.GraphQLString)},srcWebp:{type:new t.GraphQLNonNull(t.GraphQLString)},srcSetWebp:{type:new t.GraphQLNonNull(t.GraphQLString)},sizes:{type:new t.GraphQLNonNull(t.GraphQLString)},aspectRatio:{type:new t.GraphQLNonNull(t.GraphQLFloat)}}})}({name:Q(s,"ImgixFluid"),cache:n}),g=i.buildObjectType({name:Q(s,"ImgixImage"),fields:{url:F({resolveUrl:function(e){return e},secureUrlToken:u,defaultImgixParams:l}),fixed:M({type:d,resolveUrl:function(e){return e},secureUrlToken:u,defaultImgixParams:l,defaultPlaceholderImgixParams:p,cache:n}),fluid:z({type:m,resolveUrl:function(e){return e},secureUrlToken:u,defaultImgixParams:l,defaultPlaceholderImgixParams:p,cache:n})}}),y=h.map(function(e){var r;return i.buildObjectType({name:e.nodeType+"Fields",fields:(r={},r[e.fieldName]={type:"getUrls"in e?"["+g.config.name+"]":g.config.name},r)})});return o([d,m]),o(g),o(y),Promise.resolve()}catch(e){return Promise.reject(e)}var v},exports.onCreateNode=function(e,r){try{var n=function(){var n=e.node,t=e.reporter,i=e.actions.createNodeField,a=r.domain,o=r.secureUrlToken,u=r.sourceType,c=r.fields,s=void 0===c?[]:c;S(Array.isArray(s),"fields must be an array of field options",t);var l=s.filter(function(e){return e.nodeType===n.internal.type});if(l.length<1)return{v:Promise.resolve()};for(var p,f=P(l);!(p=f()).done;){var h=p.value,d=void 0;"getUrl"in h?S(null==(d=h.getUrl(n))||"string"==typeof d,"getUrl must return a URL string",t):"getUrls"in h&&(d=h.getUrls(n),S(Array.isArray(d),"getUrls must return an array of URLs",t)),d&&(u===L.WebProxy&&(S(void 0!==a,"an Imgix domain must be provided if sourceType is webProxy",t),S(void 0!==o,"a secure URL token must be provided if sourceType is webProxy",t),d=Array.isArray(d)?d.map(function(e){return G(e,a)}):G(d,a)),i({node:n,name:h.fieldName,value:d}))}return{v:Promise.resolve()}}();if("object"==typeof n)return n.v}catch(e){return Promise.reject(e)}},exports.onPreExtractQueries=function(e){var t=e.store.getState().program;r.copyFileSync(n.resolve(__dirname,"../fragments.js"),n.resolve(t.directory,".cache/fragments/gatsby-plugin-imgix-fragments.js"))};
//# sourceMappingURL=gatsby-node.js.map
